<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Supervised Learning Quiz with AutoProctor</title>

  <!-- External Libraries with defer -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js" defer></script>
  <script src="https://cdn.autoproctor.co/ap-entry.js" defer></script>

  <!-- Styling -->
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f9f9f9;
      padding: 20px;
      max-width: 900px;
      margin: auto;
      color: #222;
    }

    h1 {
      text-align: center;
      color: #333;
    }

    .question {
      background: #fff;
      padding: 15px 20px;
      margin-bottom: 20px;
      border: 1px solid #ddd;
      border-radius: 10px;
      transition: background-color 0.4s ease;
    }

    .question.correct {
      background-color: #d4edda;
      border-color: #28a745;
    }

    .question.incorrect {
      background-color: #f8d7da;
      border-color: #dc3545;
    }

    .options label {
      display: block;
      margin: 8px 0;
      cursor: pointer;
      user-select: none;
    }

    input[type="radio"]:focus + span {
      outline: 2px solid #0056b3;
      outline-offset: 2px;
      border-radius: 4px;
    }

    #result {
      font-size: 1.3em;
      font-weight: 700;
      text-align: center;
      margin-top: 25px;
      padding: 15px;
      background: #e2e3e5;
      border-radius: 8px;
      min-height: 1.5em;
      user-select: none;
    }

    button {
      padding: 12px 25px;
      font-size: 16px;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.3s ease;
      margin: 0 5px;
    }

    button:disabled, button[disabled] {
      background: #a6a6a6;
      cursor: not-allowed;
    }

    button:hover:not(:disabled) {
      background: #0056b3;
    }

    .container {
      margin-top: 30px;
      text-align: center;
    }

    .ctas {
      display: inline-flex;
      gap: 15px;
      justify-content: center;
      margin-bottom: 15px;
    }

    #btn-start-proctoring {
      background-color: #28a745;
    }

    #btn-stop-proctoring {
      background-color: #dc3545;
    }

    #proctoring-status {
      font-size: 1.2em;
      font-weight: 600;
      margin-top: 15px;
      min-height: 1.4em;
      color: #444;
    }

    /* Disable pointer events on inputs after submission */
    .quiz-disabled input,
    .quiz-disabled label {
      cursor: default;
      pointer-events: none;
      user-select: none;
      opacity: 0.85;
    }

    /* Screen-reader only text */
    .sr-only { 
      position: absolute; 
      width: 1px; 
      height: 1px; 
      padding: 0; 
      margin: -1px; 
      overflow: hidden; 
      clip: rect(0,0,0,0); 
      border: 0; 
    }
  </style>
</head>
<body>
  <h1>Supervised Learning Quiz (5 Questions)</h1>

  <!-- Proctoring Controls -->
  <div class="container" id="proctoring-container" aria-label="Proctoring Controls">
    <div class="ctas">
      <button id="btn-start-proctoring" aria-live="polite" aria-pressed="false" aria-controls="quiz-container">
        Start Proctoring
      </button>
      <button id="btn-stop-proctoring" disabled aria-live="polite" aria-pressed="false">Stop &amp; View Report</button>
    </div>
    <div id="proctoring-status" role="status" aria-live="polite"></div>
  </div>

  <!-- Quiz Container -->
  <section id="quiz-container" style="display:none;" aria-label="Quiz Questions">
    <form id="quizForm" novalidate></form>
    <div style="text-align:center; margin-top: 20px;">
      <button type="button" id="btn-submit-quiz" aria-live="polite" aria-disabled="false">Submit Quiz</button>
    </div>
    <div id="result" role="region" aria-live="polite" aria-atomic="true"></div>
  </section>

  <!-- Script -->
  <script>
    // Wait until AutoProctor and CryptoJS script loaded
    window.addEventListener('load', () => {

      // Constants for AutoProctor Credentials
      const CLIENT_ID = "tnmvX6pir7";  // Replace with your actual Test ID
      const CLIENT_SECRET = null;       // Optional, keep null if unused

      // Generates random test attempt id
      function getTestAttemptId() {
        return Math.random().toString(36).slice(2, 7);
      }

      // Return HMAC SHA256 hash of attempt id (optional)
      function getHashTestAttemptId(testAttemptId) {
        if (!CLIENT_SECRET) return null;
        const secretWordArray = CryptoJS.enc.Utf8.parse(CLIENT_SECRET);
        const messageWordArray = CryptoJS.enc.Utf8.parse(testAttemptId);
        const hash = CryptoJS.HmacSHA256(messageWordArray, secretWordArray);
        return CryptoJS.enc.Base64.stringify(hash);
      }

      // Return credentials object for AutoProctor
      function getCredentials() {
        const testAttemptId = getTestAttemptId();
        const hashedTestAttemptId = getHashTestAttemptId(testAttemptId);
        return { clientId: CLIENT_ID, testAttemptId, hashedTestAttemptId };
      }

      // Options for report modal
      const reportOptions = {
        groupReportsIntoTabs: true,
        userDetails: {
          name: "Test User",
          email: "user@example.com"
        }
      };

      // Proctoring options configuration
      const proctoringOptions = {
        trackingOptions: {
          audio: true,
          numHumans: true,
          tabSwitch: true,
          photosAtRandom: false,
          detectMultipleScreens: true,
          forceFullScreen: false,
          auxiliaryDevice: false,
          recordSession: true
        },
        showHowToVideo: false
      };

      // Quiz Questions Data
      const quizData = [
        {
          question: "Which link function is commonly used in Ordinal Logistic Regression?",
          options: {
            A: "Identity link",
            B: "Logit link",
            C: "Probit link",
            D: "Complementary log-log link"
          },
          answer: "B"
        },
        {
          question: "In simple linear regression, how many independent variables are used?",
          options: {
            A: "0",
            B: "1",
            C: "2",
            D: "More than 2"
          },
          answer: "B"
        },
        {
          question: "Which of the following assumptions underlies linear regression?",
          options: {
            A: "Homoscedasticity",
            B: "All variables are categorical",
            C: "Presence of high multicollinearity is beneficial",
            D: "Non-linearity in the regression coefficients"
          },
          answer: "A"
        },
        {
          question: "What is the primary purpose of hypothesis testing?",
          options: {
            A: "To accept the null hypothesis",
            B: "To reject the population",
            C: "To make decisions using data",
            D: "To ensure data is normally distributed"
          },
          answer: "C"
        },
        {
          question: "For a fixed confidence level, if sample size increases, the margin of error:",
          options: {
            A: "Increases",
            B: "Decreases",
            C: "Remains the same",
            D: "Doubles"
          },
          answer: "B"
        }
      ];

      // DOM Elements References
      const quizContainer = document.getElementById("quiz-container");
      const quizForm = document.getElementById("quizForm");
      const btnSubmitQuiz = document.getElementById("btn-submit-quiz");
      const btnStartProctoring = document.getElementById("btn-start-proctoring");
      const btnStopProctoring = document.getElementById("btn-stop-proctoring");
      const proctoringStatus = document.getElementById("proctoring-status");
      const resultArea = document.getElementById("result");

      // Render the quiz questions to the form
      function renderQuiz() {
        quizForm.innerHTML = ""; // Clear previous if any

        quizData.forEach((item, index) => {
          const questionDiv = document.createElement("div");
          questionDiv.classList.add("question");
          questionDiv.setAttribute("id", `question-${index}`);
          questionDiv.setAttribute("role", "group");
          questionDiv.setAttribute("aria-labelledby", `label-question-${index}`);

          const questionText = document.createElement("p");
          questionText.innerHTML = `<strong id="label-question-${index}">Q${index + 1}:</strong> ${item.question}`;
          questionDiv.appendChild(questionText);

          const optionsDiv = document.createElement("div");
          optionsDiv.className = "options";

          for (const [key, value] of Object.entries(item.options)) {
            const label = document.createElement("label");

            const input = document.createElement("input");
            input.type = "radio";
            input.name = `q${index}`;
            input.value = key;
            input.id = `q${index}-${key}`;
            input.setAttribute("aria-describedby", `label-question-${index}`);

            const span = document.createElement("span");
            span.textContent = `${key}. ${value}`;

            label.appendChild(input);
            label.appendChild(span);
            optionsDiv.appendChild(label);
          }

          questionDiv.appendChild(optionsDiv);
          quizForm.appendChild(questionDiv);
        });
      }

      // Submit quiz and calculate score
      function submitQuiz() {
        let score = 0;
        let allAnswered = true;

        // Clear previous states & result
        resultArea.textContent = "";
        quizForm.classList.remove("quiz-disabled");
        quizData.forEach((_, idx) => {
          const qDiv = document.getElementById(`question-${idx}`);
          qDiv.classList.remove("correct", "incorrect");
        });

        quizData.forEach((qItem, idx) => {
          const selectedInput = quizForm.querySelector(`input[name="q${idx}"]:checked`);
          const questionDiv = document.getElementById(`question-${idx}`);

          if (!selectedInput) {
            // Mark unanswered as incorrect
            allAnswered = false;
            questionDiv.classList.add("incorrect");
            return;
          }

          if (selectedInput.value === qItem.answer) {
            score++;
            questionDiv.classList.add("correct");
          } else {
            questionDiv.classList.add("incorrect");
          }
        });

        if (!allAnswered) {
          resultArea.textContent = "Please answer all questions before submitting.";
          resultArea.style.color = "#dc3545"; // red warning color
          return;
        }

        // Show score
        resultArea.textContent = `You scored ${score} out of ${quizData.length}`;
        resultArea.style.color = "#212529"; // reset color

        // Disable form inputs after submission
        quizForm.classList.add("quiz-disabled");

        // Disable submit button after submit
        btnSubmitQuiz.disabled = true;
        btnSubmitQuiz.setAttribute("aria-disabled", "true");
      }

      // Initialize the AutoProctor and quiz interaction
      async function initApp() {
        const credentials = getCredentials();
        const apInstance = new AutoProctor(credentials);

        await apInstance.setup(proctoringOptions);

        // Start Proctoring button event
        btnStartProctoring.addEventListener("click", async () => {
          try {
            btnStartProctoring.disabled = true;
            btnStartProctoring.setAttribute("aria-pressed", "true");
            proctoringStatus.textContent = "Starting proctoring...";
            await apInstance.start();
          } catch (err) {
            proctoringStatus.textContent = "Error starting proctoring. Please try again.";
            btnStartProctoring.disabled = false;
            btnStartProctoring.setAttribute("aria-pressed", "false");
            console.error("Proctoring start error:", err);
          }
        });

        // Stop Proctoring button event
        btnStopProctoring.addEventListener("click", async () => {
          try {
            btnStopProctoring.disabled = true;
            btnStopProctoring.setAttribute("aria-pressed", "true");
            await apInstance.stop();
          } catch (err) {
            proctoringStatus.textContent = "Error stopping proctoring.";
            btnStopProctoring.disabled = false;
            btnStopProctoring.setAttribute("aria-pressed", "false");
            console.error("Proctoring stop error:", err);
          }
        });

        // When proctoring starts
        window.addEventListener("apMonitoringStarted", () => {
          proctoringStatus.textContent = "Proctoring started.";
          btnStartProctoring.disabled = true;
          btnStartProctoring.setAttribute("aria-pressed", "true");
          btnStopProctoring.disabled = false;
          btnStopProctoring.setAttribute("aria-pressed", "false");
          quizContainer.style.display = "block";
          btnSubmitQuiz.disabled = false;
          btnSubmitQuiz.setAttribute("aria-disabled", "false");
          renderQuiz();
          resultArea.textContent = "";
          quizForm.classList.remove("quiz-disabled");
        });

        // When proctoring stops
        window.addEventListener("apMonitoringStopped", () => {
          proctoringStatus.textContent = "Proctoring stopped.";
          btnStopProctoring.disabled = true;
          btnStopProctoring.setAttribute("aria-pressed", "true");
          apInstance.showReport(reportOptions);
        });

        // Submit quiz button event
        btnSubmitQuiz.addEventListener("click", () => {
          submitQuiz();
        });
      }

      // Run the init on load
      initApp();
    });
  </script>
</body>
</html>
